<!doctype html>
<html lang="ar">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>تتبع الموقع</title>

    <!-- Include Picker.js CSS -->
    <link rel="stylesheet" href="static/css/picker.css" />
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pickerjs/dist/picker.min.css"> -->

    <link rel="stylesheet" href="static/css/index.css" />
  </head>

  <body>
    <header>
      <h1>تتبع الموقع</h1>
    </header>

    <div class="container">
      <a class="link" href="static/pages/live.html">الموقع الحي</a>
      <a class="link" href="#" id="openDatePopup">التقرير على الخريطة</a>
    </div>

    <div class="overlay" id="overlay"></div>
    <div class="date-popup" id="datePopup">
      <h3>اختر التاريخ والوقت</h3>
      <label for="startDate">تاريخ ووقت البداية:</label>
      <input type="text" id="startDate" value="2025-02-21 09:00" />
      <label for="endDate">تاريخ ووقت النهاية:</label>
      <input type="text" id="endDate" value="2025-02-21 13:00" />

      <label for="timezone">المنطقة الزمنية</label>
      <br />
      <select id="timezone" name="timezone">
        <option selected value="Asia/Damascus">Damascus</option>
        <option value="Asia/Dubai">Dubai</option>
      </select>
      <br />

      <label for="startDate">سرعة العرض</label>
      <br />

      <select id="speed" name="speed">
        <option value="2">2X</option>
        <option value="4">4X</option>
        <option value="8" selected>8X</option>
        <option value="16">16X</option>
        <option value="32">32X</option>
        <option value="64">64X</option>
        <option value="100">100X</option>
      </select>
      <br />
      <button id="submitDates">عرض التقرير</button>
    </div>

    <footer>
      <a class="link" id="websiteLink"></a>
    </footer>

    <script src="/config.js"></script>

    <script>
      const websiteLink = document.getElementById("websiteLink");

      websiteLink.href = window.APP_CONFIG.WEBSITE_URL;
      websiteLink.textContent = window.APP_CONFIG.WEBSITE_URL;
    </script>
    <script src="static/js/picker.js"></script>
    <script>
      // Initialize Picker.js on the date input fields
      const startDatePicker = new Picker(document.getElementById("startDate"), {
        format: "YYYY-MM-DD HH:mm",
        headers: true, // Show a header with "Month" and "Year"
        controls: true, // Show the time picker controls
      });

      const endDatePicker = new Picker(document.getElementById("endDate"), {
        format: "YYYY-MM-DD HH:mm",
        headers: true,
        controls: true,
      });

      // Get elements
      const openDatePopup = document.getElementById("openDatePopup");
      const datePopup = document.getElementById("datePopup");
      const overlay = document.getElementById("overlay");
      const submitDates = document.getElementById("submitDates");
      const startDateInput = document.getElementById("startDate");
      const endDateInput = document.getElementById("endDate");
      const speedInput = document.getElementById("speed");
      const timezoneInput = document.getElementById("timezone");

      // Open the date popup when the "التقرير على الخريطة" link is clicked
      openDatePopup.addEventListener("click", function (e) {
        e.preventDefault();
        datePopup.style.display = "block";
        overlay.style.display = "block";
      });

      // Close the date popup when the overlay is clicked
      overlay.addEventListener("click", function () {
        datePopup.style.display = "none";
        overlay.style.display = "none";
      });

      // Handle the submission of the selected dates
      submitDates.addEventListener("click", function (e) {
        e.preventDefault();
        const startDate = startDateInput.value;
        const endDate = endDateInput.value;
        const s = speedInput.value;
        const timezone = timezoneInput.value;
        console.log(startDate);
        console.log(endDate);

        if (startDate && endDate) {
          // Construct the query parameters
          const queryParams = `?start=${encodeURIComponent(startDate)}&end=${encodeURIComponent(endDate)}&timezone=${encodeURIComponent(timezone)}&speed=${encodeURIComponent(s)}`;

          // Redirect to the report page with the query params
          window.location.href = `static/pages/points.html${queryParams}`;
        } else {
          alert("يرجى تحديد تاريخ ووقت البداية والنهاية");
        }
      });
    </script>
  </body>
</html>
